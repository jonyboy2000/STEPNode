<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
   <TITLE>MachineState Programming Class</TITLE>
   <link rel="stylesheet" type="text/css" href="pkgcss/style.css" media = 'screen'>
</HEAD>

<BODY onload='onrun();'>
  <script type="text/javascript" src="pkgcss/tabs.js"></script>
<TABLE class=pagehead><TR>
<TD class=logo>MachineState</TD>
<TD class=quicklinks>
  <A HREF="http://www.steptools.com">[www.steptools.com]</a>
  <A HREF="../index.html">[STEP-NC Home]</A>
  <A HREF="index.html">[STEP-NC API Guide]</A>
</TD></TR>
</TABLE>

<div class=bktoc>
<FORM class=bksearch method=GET action="http://www.google.com/search">
Search STEP Tools Web Support<br>
<INPUT TYPE=text name=q size=22 maxlength=255 value="">
<INPUT TYPE=hidden name=q value="site:www.steptools.com/support">
<INPUT class=button type=submit name=sa VALUE="Google">
</FORM>
<ul>
<li><a href="#oview">Overview</a>
<li><a href="#ctor">Constructor</a>
<li><a href="#Init">Class Init()</a>
<li><a href="#AdvanceState">AdvanceState()</a>
<li><a href="#AdvanceStateByT">AdvanceStateByT()</a>
<li><a href="#GetCurrentCrossSectionParams">GetCurrentCrossSectionParams()</a>
<li><a href="#GetCurrentFeedrate">GetCurrentFeedrate()</a>
<li><a href="#GetCurrentFeedrateUnit">GetCurrentFeedrateUnit()</a>
<li><a href="#GetCurrentSpindleSpeed">GetCurrentSpindleSpeed()</a>
<li><a href="#GetCurrentSpindleSpeedUnit">GetCurrentSpindleSpeedUnit()</a>
<li><a href="#GetCurrentTechnology">GetCurrentTechnology()</a>
<li><a href="#GetCurrentToolpath">GetCurrentToolpath()</a>
<li><a href="#GetCurrentWorkingstepT">()</a>
<li><a href="#GetCurrentToolpathMaxT">GetCurrentToolpathMaxT()</a>
<li><a href="#GetEIDfromUUID">GetEIDfromUUID()</a>
<li><a href="#GetNextWSID">GetNextWSID</a>
<li><a href="#GetPrevWSID">GetPrevWSID</a>
<li><a href="#GetWSID">GetWSID</a>
<li><a href="#GoToWS">GoToWS()</a>
<li><a href="#LoadMachine">LoadMachine()</a>
<li><a href="#NextWS">NextWS()</a>
<li><a href="#OpenFile">OpenFile()</a>
<li><a href="#PrevWS">PrevWS()</a>
</ul>
</div>

<div class=main>

<!-- ============================== -->
<h2><a name=oview></a>Overview</h2>

<p>The <b>MachineState</b> object holds STEP-NC process state and
other information for material removal simulation.  You need a unique
MachineState object for every file you wish to simulate. Call the
constructor with the path to the file you wish to simulate to
instantiate an instance of it- ms = new machineState("File.stpnc"); A
second option for creating a machine state object is accessed by
calling ms = new machineState("File.stpnc", true); This will also
create a simulation alongside the Machine State. new
machineState("File.stpnc", false) will have the same behavior as new
machineState("File.stpnc")
</p>





<!-- ============================== -->
<H2 class=rule>
<A NAME=ctor></A>Constructor</H2>
<PRE>
Constructor
<B>MachineState</B>(void);
<B>MachineState</B>(String^ FileName);
</PRE>

<P>The <b>MachineState</b> class has a default constructor that takes
no arguments and one that takes a filename.  The filename version is
equivalent to creating the object with the default constructor and
then calling <a href="#OpenFile">OpenFile</a>().





<!-- ============================== -->
<H2 class=rule>
<A NAME=Init></A>Class Init()</H2>
<PRE>
static void <B>Init</B>()
</PRE>

<P>The <b>MachineState</b> class has a static <b>Init</b>() function
that should be called at the start of an application to do some
general initialization.


<!-- ============================== -->
<h2 class=rule>
<a name=AdvanceState></a>AdvanceState()</h2>
<pre>
int <b>AdvanceState</b> ();
</pre>

<P>The <b>AdvanceState()</b> function advances the simulation by the
smallest possible amount. This will move the tool along all of the
toolpaths within a workingstep.

<p>The function returns zero (0) while moving along the workingstep.
It returns one (1) when it reaches the end of the workingstep and will
continue to return one until you call <a href="#NextWS">NextWS</a>()
to advance to the next workingstep.  The function returns -1 if an
error occured.

<p>When simulating material removal, the function returns immediately,
but the computation is done in a separate thread.   Call
<a href="#WaitForStateUpdate">WaitForStateUpdate</a>() to block until
the removal is complete.


<!-- ============================== -->
<H2 class=rule>
<A NAME=AdvanceStateByT></A>AdvanceStateByT()</H2>
<PRE>
int <B>AdvanceStateByT</B>(double t)
</PRE>

<P>The <b>AdvanceStateByT</b>() function behaves
as <a href="#AdvanceState">AdvanceState</a>() but it advances the
simulation by a user-specified toolpath curve parameter value.
See <a href="#GetCurrentWorkingstepT">GetCurrentWorkingstepT</a>() for
a discussion of parametric curves.




<!-- ================================ -->
<h2 class=rule><a name=GetCurrentCrossSectionParams></a>GetCurrentCrossSectionParams()</h2>
<pre>
void <b>GetCurrentCrossSectionParams</b> (
	[System::Runtime::InteropServices::Out] System::String^ %name,
	[System::Runtime::InteropServices::Out] double %admax,
	[System::Runtime::InteropServices::Out] double %rdmax,
	[System::Runtime::InteropServices::Out] double %xmaxofs,
	[System::Runtime::InteropServices::Out] double %ymaxofs,
	[System::Runtime::InteropServices::Out] double %csa,
	[System::Runtime::InteropServices::Out] double %xcgofs,
	[System::Runtime::InteropServices::Out] double %ycgofs
	);
</pre>

<P>The <b>GetCurrentCrossSectionParams()</b> function returns the
aggregate cross section parameters calculated from the most recent
material removal simulation, but certain files may also have the
parameters stored with the toolpath.  These parameters describe a 2D
profile in the plane normal to the feed direction.

<ul>
<li><b>admax</b> is the maximum axial depth of the tool contact cross
section.  The axial depth is measured parallel to the tool axis.  For
turning, this is measured parallel to the spindle axis.

<li><b>rdmax</b> is the maximum radial depth of the tool contact cross
section.  The radial depth is perpendicular to both tool axis and feed
direction.

<li><b>xmaxofs</b> is the location along the X axis where the maximum
radial depth measure is located.  This is the radial offset of the
origin (lower left corner) of tool contact cross section measured from
the tool tip.

<li><b>ymaxofs</b> is the location along the Y axis where the maximum
axial depth measure is located.  This is the axial offset of the
origin (lower left corner) of tool contact cross section measured from
the tool tip.

<li><b>csa</b> is the total cross section area of the tool engagement.

<li><b>xcgofs</b> is the radial offset of the center of gravity of
this cross section area.  It is measured from the tool tip.

<li><b>ycgofs</b> is the axial offset of the center of gravity of this
cross section area.  It is measured from the tool tip.

</ul>

<img width="75%" src=images/cross_section.png>



<!-- ============================== -->
<h2 class=rule>
<a name=GetCurrentFeedrate></a>GetCurrentFeedrate()</h2>
<div class='tabview'>
<pre class='.net'>
double <b>GetCurrentFeedrate</b> ();
</pre>
<pre class="node.js">
double <b>GetCurrentFeedrate</b> ();
</pre>
<pre class="C++">
double <b>GetCurrentFeedrate</b> ();
</pre>
</div>

<P>The <b>GetCurrentFeedrate()</b> function returns the numeric value
of the feed rate at the current point in the machining program.

<!-- ============================== -->
<h2 class=rule>
<a name=GetCurrentFeedrateUnit></a>GetCurrentFeedrateUnit()</h2>
<div class='tabview'>
<pre class='.net'>
String <b>GetCurrentFeedrateUnit</b> ();
</pre>
<pre class="C++">
RoseUnit <b>GetCurrentFeedrate</b> ();
</pre>
</div>

<P>The <b>GetCurrentFeedrateUnit()</b> function returns the unit for
the feed rate at the current point in the machining program.  



<!-- ============================== -->
<h2 class=rule>
<a name=GetCurrentSpindleSpeed></a>GetCurrentSpindleSpeed()</h2>
<div class='tabview'>
<pre class='.net'>
double <b>GetCurrentSpindleSpeed</b> ();
</pre>
<pre class="node.js">
double <b>GetCurrentSpindleSpeed</b> ();
</pre>
<pre class="C++">
double <b>GetCurrentSpindleSpeed</b> ();
</pre>
</div>

<P>The <b>GetCurrentSpindleSpeed()</b> function returns the numeric
value of the spindle speed at the current point in the machining
program.  A zero value means the spindle is stopped.  A positive value
indicates counter-clockwise rotation and a negative value indicates
clockwise rotation.  The direction are given looking down the tool
axis from the spindle towards the tip of the tool.



<!-- ============================== -->
<h2 class=rule>
<a name=GetCurrentSpindleSpeedUnit></a>GetCurrentSpindleSpeedUnit()</h2>
<div class='tabview'>
<pre class='.net'>
String <b>GetCurrentSpindleSpeedUnit</b> ();
</pre>
<pre class="C++">
RoseUnit <b>GetCurrentSpindleSpeedUnit</b> ();
</pre>
</div>

<P>The <b>GetCurrentSpindleSpeed()</b> function returns the unit value
of the spindle speed in the machining program.  





<!-- ============================== -->
<H2 class=rule>
<A NAME=GetCurrentTechnology></A>GetCurrentTechnology()</H2>
<div class='tabview'>
<pre class='.net'>
System::Int64 <B>GetCurrentTechnology</B>();
</pre>
<pre class="C++">
stp_machining_technology * <B>GetCurrentTechnology</B>();
</pre>

<P>The <b>GetCurrentTechnology</b>() function returns the technology
settings at the current location in the STEP-NC program.  The
technology instance contains the feedrate and spindle speed settings.



<!-- ============================== -->
<H2 class=rule>
<A NAME=GetCurrentToolpath></A>GetCurrentToolpath()</H2>
<div class='tabview'>
<pre class='.net'>
System::Int64 <B>GetCurrentToolpath</B>();
</pre>
<pre class="C++">
stp_machining_toolpath * <B>GetCurrentToolpath</B>();
</pre>

<P>The <b>GetCurrentToolpath</b>() function returns the toolpath 
instance at the current location in the STEP-NC program.  



<!-- ============================== -->
<H2 class=rule>
<A NAME=GetCurrentWorkingstepT></A>GetCurrentWorkingstepT()</H2>
<PRE>
double <B>GetCurrentWorkingstepT</B>()
</PRE>

<P>The <b>GetCurrentWorkingstepT</b>() function returns the curve
parameter value at the current location in the workingstep.  Toolpaths
are stored as STEP curves which can be described as a function of a
single parameter f(t).  The parameterization of each different type of
curve is given by ISO 10303-42.  A workingstep can have many toolpaths
and the parameter ranged of all of them are concatenated.  The T value
returned by this function is the location in all of the toolpaths of
the workingstep.

<p>Polylines are the most common curve used for toolpaths and each
point on the line increments the T by one.  So the first point is at
T=0, the second point is at T=1, and so on.

<p>It is important to note that this value is not directly linked to
either time or distance, but it can be compared against the maximum T
value to estimate progress through a workingstep.


<!-- ============================== -->
<H2 class=rule>
<A NAME=GetCurrentWorkingstepMaxT></A>GetCurrentWorkingstepMaxT()</H2>
<PRE>
double <B>GetCurrentWorkingstepMaxT</B>()
</PRE>

<P>The <b>GetCurrentWorkingstepMaxT</b>() function returns the maximum
curve parameter value for the current workingstep, which is the sum of
the max parameters of all toolpaths.
See <a href="#GetCurrentToolpathT">GetCurrentToolpathT</a>() for a
discussion of curve parameters.




<!-- ============================== -->
<h2 class=rule>
<a name=GetEIDfromUUID></a>GetEIDfromUUID()</h2>
<div class='tabview'>
<pre class='.net'>
</pre>
<pre class="node.js">
int <b>GetEIDfromUUID</b> (
	int uuid
);
</pre>
<pre class="C++">
RoseObject * <b>FindObjectByID</b> (
	int uuid
);
</pre>
</div>

<P>The <b>GetEIDfromUUID()</b> function returns the entity id that is
associated with the uuid given.



<!-- ============================== -->
<h2 class=rule>
<a name=GetNextWSID></a>GetNextWSID</h2>
<div class='tabview'>
<pre class='.net'>
System::Int64 <b>GetNextWSID</b> ();
</pre>
<pre class="node.js">
int <b>GetNextWSID</b> ();
</pre>
<pre class="C++">
int <b>GetNextWSID</b> ();
</pre>
</div>

<p>The <b>GetNextWSID</b> function returns the identifier of the
workingstep preceeding the current location in the machine process.
The workingsteps are linearized, so any nested workplans, disabled
steps, and so forth do not appear.
Use <a href="#GetPrevWSID">GetPrevWSID</a>() or
or <a href="#GetWSID">GetWSID</a>() to get the preceeding or active
workingsteps in the sequence.


<!-- ============================== -->
<h2 class=rule>
<<<<<<< HEAD
<a name=GetPrevWSID></a>GetPrevWSID</h2>
<div class='tabview'>
<pre class='.net'>
System::Int64 <b>GetPrevWSID</b> ();
</pre>
<pre class="node.js">
int <b>GetPrevWSID</b> ();
</pre>
<pre class="C++">
int <b>GetPrevWSID</b> ();
</pre>
</div>

<p>The <b>GetPrevWSID</b> function returns the identifier of the
workingstep preceeding the current location in the machine process.
The workingsteps are linearized, so any nested workplans, disabled
steps, and so forth do not appear.
Use <a href="#GetNextWSID">GetNextWSID</a>() or
or <a href="#GetWSID">GetWSID</a>() to get the following or active
workingsteps in the sequence.




<!-- ============================== -->
<h2 class=rule>
<a name=GetWSID></a>GetWSID</h2>
<div class='tabview'>
<pre class='.net'>
System::Int64 <b>GetWSID</b> ();
</pre>
<pre class="node.js">
int <b>GetWSID</b> ();
</pre>
<pre class="C++">
int <b>GetWSID</b> ();
</pre>
</div>

<p>The <b>GetWSID</b> function returns the identifier of the
workingstep at the current location in the machine process.  The
workingsteps are linearized, so any nested workplans, disabled steps,
and so forth do not appear.
Use <a href="#GetNextWSID">GetNextWSID</a>()
or <a href="#GetPrevWSID">GetPrevWSID</a>() to get adjacent
workingsteps in the sequence.






<!-- ============================== -->
<H2 class=rule>
<A NAME=GoToWS></A>GoToWS()</H2>
<PRE>
int <B>GoToWS</B>(System::Int64 wsid)
</PRE>

<P>The <b>GoToWS</b>() function changes the current position of the
machine state to the start of the given workingstep.  Returns 0 if the
operation succeeds or -1 if an error occured.





<!-- ============================== -->
<H2 class=rule>
<A NAME=LoadMachine></A>LoadMachine()</H2>
<PRE>
void <B>LoadMachine</B>(String^ FileName);
</PRE>

<P>The <b>LoadMachine</b>() function initializes the machine state
object with a machine tool model.  The file must be an XML description
file as found in the "machines" subdirectory of STEP-NC Machine
installation.  This XML file annotates a plain STEP assembly to
identify the geometry for each axis.  The file is a trivial wrapper if
the STEP model is an advanced AP242 file with kinematics.



<!-- ============================== -->
<H2 class=rule>
<A NAME=NextWS></A>NextWS()</H2>
<PRE>
void <b>NextWS</b> ();
</PRE>

<P>The <b>NextWS</b>() function changes the current execution position
to the start of the next sequential workingstep.




<!-- ============================== -->
<H2 class=rule>
<A NAME=OpenFile></A>OpenFile()</H2>
<PRE>
void <B>OpenFile</B>(String^ FileName, Boolean enable_sim);
</PRE>

<P>The <b>OpenFile</b>() function initializes the machine state object
to work with the machining project in the given STEP-NC file.  The
second parameter is an optional boolean value that indicates whether
to do material removal simulation.




<!-- ============================== -->
<H2 class=rule>
<A NAME=PrevWS></A>PrevWS()</H2>
<PRE>
void <b>PrevWS</b> ();
</PRE>

<P>The <b>PrevWS</b>() function changes the current execution position
to the start of the previous sequential workingstep.



<!-- ============================== -->
<a name="GetDeltaStateJSON"></a><a name="GetKeyStateJSON"></a>GetKeyStateJSON() GetDeltaStateJSON()</h2>
<div class='tabview'>
<pre class='.net'>
String^ <b>GetKeyStateJSON</b>();
</pre>
<pre class='node.js'>
string <b>GetKeyStateJSON</b>();
</pre>
<pre class='C++'>
RoseStringObject <b>GetStateJSON</b>(
    bool keyframe
);
</pre>
</div>
<div class='tabview'>
<pre class='.net'>
String^ <b>GetDeltaStateJSON</b>();
</pre>
<pre class='node.js'>
string <b>GetDeltaStateJSON</b>();
</pre>
<pre class='C++'>
RoseStringObject <b>GetStateJSON</b>(
    bool keyframe
);
</pre>
</div>

<P>The <b>GetKeyStateJSON()</b> function return a JSON object which
describes the current placement of geometry objects in the scene.

<p>The <b>GetDeltaStateJSON()</b> function returns a JSON object with
only the items that have moved since the last call to either of these
two functions.  The C++ version takes a bool, when true it returns a
Key State, when false it returns a Delta State.





<!-- ============================== -->
<H2 class=rule>
<A NAME=WaitForStateUpdate></A>WaitForStateUpdate()</H2>
<PRE>
int <B>WaitForStateUpdate</B>();
</PRE>

<P>The <b>WaitForStateUpdate</b>() function blocks
until <a href="#AdvanceState">AdvanceState</a>() finishes calculations
in a separate thread, and it will return the same return code as the
original call to AdvanceState().

<p>If material removal is not being calculated, the function returns
immediately.  The return value should not be used for anything if not
doing material removal.


</div>

<div class="copyright">
  Copyright &copy; 2016 STEP Tools Inc. All Rights Reserved.<br>
</div>
</BODY>
</HTML>

